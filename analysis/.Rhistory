mutate(time_to_event = as.numeric(time_to_event)) %>%
mutate(time_in_hospital = as.numeric(time_in_hospital)) %>%
mutate(vax_status = if_else(is.na(vaccine_name), "No_vax", "Vax")) %>%
mutate(vac_status = case_when(vax_status == "Vax" & lastvac_date < exam_date ~ "Vax",
TRUE ~ "No_vax")) %>%
dplyr::select(-vax_status) %>%
mutate(time_after_vax = case_when(vac_status == "Vax" ~ difftime(exam_date,lastvac_date, units = "days"),
vac_status == "No_vax"  ~ 0)) %>%
mutate(time_after_vax = as.numeric(time_after_vax))
cov$time_to_event <- replace(cov$time_to_event, cov$time_to_event <= 0 & cov$hospital_treat == "Home" , NA)
cov$time_to_event <- replace(cov$time_to_event, cov$time_to_event < 0, NA)
cov$time_after_vax <- replace(cov$time_after_vax, cov$time_after_vax < 0, NA)
cov$time_in_hospital <- replace(cov$time_in_hospital, cov$time_in_hospital <= 0, NA)
cov["age_group"] = cut(cov$age, c(0, 14, 24,34, 44, 54, 64, 74, 84, 94, Inf),
c("0-14","15-24","25-34","35-44","45-54","55-64",
"65-74","75-84","85-94","> 95"), include.lowest=TRUE)
hospitalis_hospitals = cov %>%
filter(hospital_treat=="Hospital") %>%
dplyr::select(vac_status,wave,gender, age) %>%
mutate(male = ifelse(gender=="M",1,0)) %>%
mutate(vacinated = ifelse(vac_status =="Vax",1,0)) %>%
mutate(case_fatality = ifelse(status == "R",0,1)) %>%
dplyr::select(age,wave,male,vacinated,case_fatality) %>%
tbl_summary(
by = wave,
statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)")) %>%
add_p() %>%
as_flex_table()
hospitalis_hospitals
hospitalis_hospitals = cov %>%
filter(hospital_treat=="Hospital") %>%
dplyr::select(vac_status,wave,gender, status,age) %>%
mutate(male = ifelse(gender=="M",1,0)) %>%
mutate(vacinated = ifelse(vac_status =="Vax",1,0)) %>%
mutate(case_fatality = ifelse(status == "R",0,1)) %>%
dplyr::select(age,wave,male,vacinated,case_fatality) %>%
tbl_summary(
by = wave,
statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)")) %>%
add_p() %>%
as_flex_table()
hospitalis_hospitals
hospitalis_R = cov %>%
filter(status== "R") %>%
dplyr::select(vac_status,wave,gender, age, hospital_treat) %>%
mutate(male = ifelse(gender=="M",1,0)) %>%
mutate(hospitalized = ifelse(hospital_treat=="Hospital",1,0)) %>%
mutate(vacinated = ifelse(vac_status =="Vax",1,0)) %>%
dplyr::select(age,wave,male,hospitalized,vacinated) %>%
tbl_summary(
by = wave,
statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)")) %>%
add_p() %>%
as_flex_table()
hospitalis_R
hospitalis_D = cov %>%
filter(status== "D") %>%
dplyr::select(vac_status,wave,gender, age, hospital_treat) %>%
mutate(male = ifelse(gender=="M",1,0)) %>%
mutate(hospitalized = ifelse(hospital_treat=="Hospital",1,0)) %>%
mutate(vacinated = ifelse(vac_status =="Vax",1,0)) %>%
dplyr::select(age,wave,male,hospitalized,vacinated) %>%
tbl_summary(
by = wave,
statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)")) %>%
add_p() %>%
as_flex_table()
hospitalis_D
procent_death = cov %>% group_by(status, vac_status) %>% summarise(n=n())
procent_death = cov %>% group_by(status, vac_status) %>% dplyr::summarise(n=n())
procent_death
province_v = cov %>%
filter(vac_status == "Vax") %>%
freq_table(province,comp_outcome) %>%
rename(n_vacinated = n,
prop_vacinated = prop)
province_nv = cov %>%
filter(vac_status == "No_vax") %>%
freq_table(province,comp_outcome) %>%
rename(non_vax_n = n,
non_vac_prop = prop)
province_all = province_v %>%
inner_join(province_nv) %>%
mutate(dif_vax_nonvax = (non_vac_prop-prop_vacinated)) %>%
select(province, comp_outcome,dif_vax_nonvax) %>%
pivot_wider(names_from = comp_outcome, values_from = dif_vax_nonvax) %>%
select(-Recovery) %>%
rename(case_fatality_dif= Death,
hospitalisation_dif = Hospitalized) %>%
flextable()
province_all
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
# Chunk 2: pakeges
library(tidyverse)
library(easystats)
library(tayloRswift)
library(readr)
library(officer)
library(janitor)
library(flextable)
library(apyramid)
library(rstatix)
library(gtsummary)
library(arsenal)
library(gt)
library(emmeans)
library(chisq.posthoc.test)
Sys.setlocale(locale = "Bulgarian")
# Chunk 3: read_data
cov = read_csv("C:\\\\Users\\PC\\Desktop\\covid_full.csv",
col_types = cols(exam_date = col_date(format = "%d.%m.%Y"),
lastvac_date = col_date(format = "%d.%m.%Y"),
start_hospis = col_date(format = "%d.%m.%Y"),
end_hospis = col_date(format = "%d.%m.%Y")))
cov = as_tibble(cov)
dth <- read_csv("https://raw.githubusercontent.com/kostadinoff/COVID-19-MH/master/data/COVID_MH_data/deaths.csv", col_types = cols(add_day = col_date(format = "%Y-%m-%d"),
death_day = col_date(format = "%Y-%m-%d")))
dth = as_tibble(dth)
# Chunk 4: data_prepare
cov = cov %>%
mutate(status = if_else(is.na(outcome_covid), "R", "D")) %>%
mutate(hospital_treat = ifelse(is.na(start_hospis), "Home", "Hospital")) %>%
mutate(wave = case_when(exam_date <='2021-07-07'~ "alpha",
exam_date > '2021-07-07' & exam_date <= '2022-01-26' ~ "delta",
exam_date > '2022-01-26'~ "omicron")) %>%
mutate(time_to_event = case_when(hospital_treat == "Hospital" ~difftime(start_hospis, exam_date, units = "days"),
hospital_treat == "Home" ~ 0)) %>%
mutate(time_in_hospital = case_when(hospital_treat == "Hospital" ~difftime(end_hospis, start_hospis, units = "days"),
hospital_treat == "Home" ~ 0)) %>%
mutate(time_to_event = as.numeric(time_to_event)) %>%
mutate(time_in_hospital = as.numeric(time_in_hospital)) %>%
mutate(vax_status = if_else(is.na(vaccine_name), "No_vax", "Vax")) %>%
mutate(vac_status = case_when(vax_status == "Vax" & lastvac_date < exam_date ~ "Vax",
TRUE ~ "No_vax")) %>%
dplyr::select(-vax_status) %>%
mutate(time_after_vax = case_when(vac_status == "Vax" ~ difftime(exam_date,lastvac_date, units = "days"),
vac_status == "No_vax"  ~ 0)) %>%
mutate(time_after_vax = as.numeric(time_after_vax))
cov$time_to_event <- replace(cov$time_to_event, cov$time_to_event <= 0 & cov$hospital_treat == "Home" , NA)
cov$time_to_event <- replace(cov$time_to_event, cov$time_to_event < 0, NA)
cov$time_after_vax <- replace(cov$time_after_vax, cov$time_after_vax < 0, NA)
cov$time_in_hospital <- replace(cov$time_in_hospital, cov$time_in_hospital <= 0, NA)
cov["age_group"] = cut(cov$age, c(0, 14, 24,34, 44, 54, 64, 74, 84, 94, Inf),
c("0-14","15-24","25-34","35-44","45-54","55-64",
"65-74","75-84","85-94","> 95"), include.lowest=TRUE)
# Chunk 5: wave_characteristics
hospitalis_all = cov %>%
dplyr::select(vac_status,status,wave,gender, age, hospital_treat) %>%
mutate(male = ifelse(gender=="M",1,0)) %>%
mutate(hospitalized = ifelse(hospital_treat=="Hospital",1,0)) %>%
mutate(vacinated = ifelse(vac_status =="Vax",1,0)) %>%
mutate(case_fatality = ifelse(status == "R",0,1)) %>%
dplyr::select(age,wave,male,hospitalized,vacinated,case_fatality ) %>%
tbl_summary(
by = wave,
statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)")) %>%
add_p() %>%
as_flex_table()
hospitalis_all
# Chunk 6: wave_characteristics_1
hospitalis_R = cov %>%
filter(status== "R") %>%
dplyr::select(vac_status,wave,gender, age, hospital_treat) %>%
mutate(male = ifelse(gender=="M",1,0)) %>%
mutate(hospitalized = ifelse(hospital_treat=="Hospital",1,0)) %>%
mutate(vacinated = ifelse(vac_status =="Vax",1,0)) %>%
dplyr::select(age,wave,male,hospitalized,vacinated) %>%
tbl_summary(
by = wave,
statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)")) %>%
add_p() %>%
as_flex_table()
hospitalis_R
# Chunk 7: wave_characteristics_1
hospitalis_hospitals = cov %>%
filter(hospital_treat=="Hospital") %>%
dplyr::select(vac_status,wave,gender, status,age) %>%
mutate(male = ifelse(gender=="M",1,0)) %>%
mutate(vacinated = ifelse(vac_status =="Vax",1,0)) %>%
mutate(case_fatality = ifelse(status == "R",0,1)) %>%
dplyr::select(age,wave,male,vacinated,case_fatality) %>%
tbl_summary(
by = wave,
statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)")) %>%
add_p() %>%
as_flex_table()
hospitalis_hospitals
# Chunk 8: wave_characteristics_2
hospitalis_D = cov %>%
filter(status== "D") %>%
dplyr::select(vac_status,wave,gender, age, hospital_treat) %>%
mutate(male = ifelse(gender=="M",1,0)) %>%
mutate(hospitalized = ifelse(hospital_treat=="Hospital",1,0)) %>%
mutate(vacinated = ifelse(vac_status =="Vax",1,0)) %>%
dplyr::select(age,wave,male,hospitalized,vacinated) %>%
tbl_summary(
by = wave,
statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)")) %>%
add_p() %>%
as_flex_table()
hospitalis_D
province_all
province_v = cov %>%
filter(vac_status == "Vax") %>%
freq_table(province,comp_outcome) %>%
rename(n_vacinated = n,
prop_vacinated = prop)
province_nv = cov %>%
filter(vac_status == "No_vax") %>%
freq_table(province,comp_outcome) %>%
rename(non_vax_n = n,
non_vac_prop = prop)
province_all = province_v %>%
inner_join(province_nv) %>%
mutate(dif_vax_nonvax = (non_vac_prop-prop_vacinated)) %>%
select(province, comp_outcome,dif_vax_nonvax) %>%
pivot_wider(names_from = comp_outcome, values_from = dif_vax_nonvax) %>%
select(-Recovery) %>%
rename(case_fatality_dif= Death,
hospitalisation_dif = Hospitalized) %>%
flextable()
province_all
province_all
province_v = cov %>%
filter(vac_status == "Vax") %>%
freq_table(province,comp_outcome) %>%
rename(n_vacinated = n,
prop_vacinated = prop)
cov = cov %>%
mutate(comp_outcome = case_when(hospital_treat == "Home" ~ "Recovery",
status == "D" ~ "Death",
TRUE ~ "Hospitalized"))
province_v = cov %>%
filter(vac_status == "Vax") %>%
freq_table(province,comp_outcome) %>%
rename(n_vacinated = n,
prop_vacinated = prop)
province_nv = cov %>%
filter(vac_status == "No_vax") %>%
freq_table(province,comp_outcome) %>%
rename(non_vax_n = n,
non_vac_prop = prop)
province_all = province_v %>%
inner_join(province_nv) %>%
mutate(dif_vax_nonvax = (non_vac_prop-prop_vacinated)) %>%
select(province, comp_outcome,dif_vax_nonvax) %>%
pivot_wider(names_from = comp_outcome, values_from = dif_vax_nonvax) %>%
select(-Recovery) %>%
rename(case_fatality_dif= Death,
hospitalisation_dif = Hospitalized) %>%
flextable()
province_all
province_v = cov %>%
filter(vac_status == "Vax") %>%
freq_table(province,comp_outcome) %>%
rename(n_vacinated = n,
prop_vacinated = prop)
province_v
view(province_v )
view(province_v )
view(province_v )
view(province_v )
view(province_v )
province_nv = cov %>%
filter(vac_status == "No_vax") %>%
freq_table(province,comp_outcome) %>%
rename(non_vax_n = n,
non_vac_prop = prop)
province_nv
view(province_Ð½v )
view(province_nv )
timing = cov %>%
filter(hospital_treat == "Hospital") %>%
select(status,time_to_event, time_in_hospital) %>%
tbl_summary(by = status,
statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)"),
missing="no") %>%
add_difference() %>%
as_flex_table()
timing
View(cov)
View(cov)
timing = cov %>%
filter(hospital_treat == "Hospital") %>%
filter(time_to_event= 0) %>% group_by(status) %>% summarise(n=n())
timing = cov %>%
+     filter(hospital_treat == "Hospital") %>%
+     filter(time_to_event== 0 %>% group_by(status) %>% summarise(n=n())
timing = cov %>%
filter(hospital_treat == "Hospital") %>%
filter(time_to_event== 0 %>% group_by(status) %>% summarise(n=n())
timing = cov %>%
filter(hospital_treat == "Hospital") %>%
filter(time_to_event== 0) %>% group_by(status) %>% summarise(n=n())
timing = cov %>%
filter(hospital_treat == "Hospital") %>%
filter(time_to_event== 0) %>% group_by(status) %>% summarise(n=n())
timing
timing = cov %>%
filter(hospital_treat == "Hospital") %>%
select(status,time_to_event, time_in_hospital) %>%
tbl_summary(by = status,
statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)"),
missing="no") %>%
add_difference() %>%
as_flex_table()
timing
timing_vax = cov %>%
filter(hospital_treat == "Hospital") %>%
filter(vac_status == "Vax") %>%
select(status,time_to_event, time_in_hospital) %>%
tbl_summary(by = status,
statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)"),
missing="no") %>%
add_difference() %>%
as_flex_table()
timing_vax
timing_nvax = cov %>%
filter(hospital_treat == "Hospital") %>%
filter(vac_status == "No_vax") %>%
select(status,time_to_event, time_in_hospital) %>%
tbl_summary(by = status,
statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)"),
missing="no") %>%
add_difference() %>%
as_flex_table()
timing_nvax
vacine_letal =
cov %>%
filter(vac_status == "Vax") %>%
select(status, time_after_vax) %>%
mutate(time_after_vac = ifelse(time_after_vax %in% 0:30, "Up to 1mo", "More than 1mo"),
case_fatality = ifelse(status=="D",1,0)) %>%
select(time_after_vac,case_fatality) %>%
tbl_summary(
by = time_after_vac
) %>%
add_difference() %>%
as_flex_table()
vacine_letal
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(easystats)
library(tayloRswift)
library(readr)
library(officer)
library(janitor)
library(flextable)
library(apyramid)
library(rstatix)
library(gtsummary)
library(arsenal)
library(gt)
library(emmeans)
library(chisq.posthoc.test)
Sys.setlocale(locale = "Bulgarian")
install.packages(c("bayestestR", "blob", "broom", "broom.helpers", "car", "checkmate", "cli", "datawizard", "dplyr", "fansi", "gert", "ggplot2", "glue", "gt", "gtsummary", "haven", "httr", "igraph", "insight", "knitr", "labelled", "magrittr", "maptools", "modelbased", "nloptr", "parameters", "performance", "ps", "quantreg", "RColorBrewer", "Rcpp", "readxl", "rlang", "rmarkdown", "rprojroot", "rsvg", "scales", "see", "sp", "testthat", "tibble", "tzdb", "uuid", "vctrs", "xfun"))
install.packages(c("bayestestR", "blob", "broom", "broom.helpers", "car", "checkmate", "cli", "datawizard", "dplyr", "fansi", "gert", "ggplot2", "glue", "gt", "gtsummary", "haven", "httr", "igraph", "insight", "knitr", "labelled", "magrittr", "maptools", "modelbased", "nloptr", "parameters", "performance", "ps", "quantreg", "RColorBrewer", "Rcpp", "readxl", "rlang", "rmarkdown", "rprojroot", "rsvg", "scales", "see", "sp", "testthat", "tibble", "tzdb", "uuid", "vctrs", "xfun"))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(easystats)
library(tayloRswift)
library(readr)
library(officer)
library(janitor)
library(flextable)
library(apyramid)
library(rstatix)
library(gtsummary)
library(arsenal)
library(gt)
library(emmeans)
library(chisq.posthoc.test)
Sys.setlocale(locale = "Bulgarian")
cov = read_csv("C:\\\\Users\\PC\\Desktop\\covid_full.csv",
col_types = cols(exam_date = col_date(format = "%d.%m.%Y"),
lastvac_date = col_date(format = "%d.%m.%Y"),
start_hospis = col_date(format = "%d.%m.%Y"),
end_hospis = col_date(format = "%d.%m.%Y")))
cov = as_tibble(cov)
knitr::opts_chunk$set(echo = TRUE)
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
# Chunk 2: pakeges
library(tidyverse)
library(easystats)
library(tayloRswift)
library(readr)
library(officer)
library(janitor)
library(flextable)
library(apyramid)
library(rstatix)
library(gtsummary)
library(arsenal)
library(gt)
library(emmeans)
library(chisq.posthoc.test)
Sys.setlocale(locale = "Bulgarian")
# Chunk 3: read_data
cov = read_csv("C:\\\\Users\\PC\\Desktop\\covid_full.csv",
col_types = cols(exam_date = col_date(format = "%d.%m.%Y"),
lastvac_date = col_date(format = "%d.%m.%Y"),
start_hospis = col_date(format = "%d.%m.%Y"),
end_hospis = col_date(format = "%d.%m.%Y")))
cov = as_tibble(cov)
# Chunk 4: data_prepare
cov = cov %>%
mutate(status = if_else(is.na(outcome_covid), "R", "D")) %>%
mutate(hospital_treat = ifelse(is.na(start_hospis), "Home", "Hospital")) %>%
mutate(wave = case_when(exam_date <='2021-07-07'~ "alpha",
exam_date > '2021-07-07' & exam_date <= '2022-01-26' ~ "delta",
exam_date > '2022-01-26'~ "omicron")) %>%
mutate(time_test_hospital = case_when(hospital_treat == "Hospital" ~difftime(start_hospis, exam_date, units = "days"),
hospital_treat == "Home" ~ 0)) %>%
mutate(time_in_hospital = case_when(hospital_treat == "Hospital" ~difftime(end_hospis, start_hospis, units = "days"),
hospital_treat == "Home" ~ 0)) %>%
mutate(time_test_hospital = as.numeric(time_test_hospital)) %>%
mutate(time_in_hospital = as.numeric(time_in_hospital)) %>%
mutate(vax_status = if_else(is.na(vaccine_name), "No_vax", "Vax")) %>%
mutate(vac_status = case_when(vax_status == "Vax" & lastvac_date < exam_date ~ "Vax",
TRUE ~ "No_vax")) %>%
dplyr::select(-vax_status) %>%
mutate(time_after_vax = case_when(vac_status == "Vax" ~ difftime(exam_date,lastvac_date, units = "days"),
vac_status == "No_vax"  ~ 0)) %>%
mutate(time_after_vax = as.numeric(time_after_vax)) %>%
mutate(month = format(exam_date, "%m"), year = format(exam_date, "%Y"))
# Chunk 5: data_prepare
cov$time_to_event <- replace(cov$time_to_event, cov$time_to_event <= 0 & cov$hospital_treat == "Home" , NA)
cov$time_to_event <- replace(cov$time_to_event, cov$time_to_event < 0, NA)
cov$time_after_vax <- replace(cov$time_after_vax, cov$time_after_vax < 0, NA)
cov$time_in_hospital <- replace(cov$time_in_hospital, cov$time_in_hospital <= 0, NA)
cov["age_group"] = cut(cov$age, c(0, 14, 24,34, 44, 54, 64, 74, 84, 94, Inf),
c("0-14","15-24","25-34","35-44","45-54","55-64",
"65-74","75-84","85-94","> 95"), include.lowest=TRUE)
# Chunk 6: read_data
rhi = read_csv("C:\\\\Users\\PC\\Desktop\\rhi_m.csv",
col_types = cols(date = col_date(format = "%d/%m/%Y")))
rhi = rhi %>%
as_tibble() %>%
mutate(month = format(date, "%m"), year = format(date, "%Y")) %>%
rename( province = region )
# Chunk 7: read_data
rhi_due = read_csv("C:\\\\Users\\PC\\Desktop\\rhi_y.csv",
col_types = cols(year = col_character()))
# Chunk 8: read_data
population = read_csv("C:\\\\Users\\PC\\Desktop\\population.csv")
population = population %>%
rename("2022" = "av_p") %>%
pivot_longer(cols = 3:5, names_to = "year", values_to = "population") %>%
rename(province = region)
# Chunk 9: read_data
cov_pivot = cov %>%
group_by(province, month, year) %>%
summarise(n = n())
# Chunk 10: read_data
jt = cov_pivot %>%
left_join(population) %>%
left_join(rhi_due)
# Chunk 11: read_data
cov  = cov %>%
left_join(jt)
# Chunk 12: read_data
doses_dates <- read_csv("C:/Users/PC/Desktop/doses_dates.csv",
col_types = cols(date = col_datetime(format = "%d/%m/%Y %H:%M"),
...3 = col_skip()))
doses_dates = doses_dates %>%
mutate(month = format(date, "%m"), year = format(date, "%Y")) %>%
rename(province = region) %>%
select(-date)
# Chunk 13: read_data
doses_types <- read_csv("C:/Users/PC/Desktop/doses_types.csv")
# Chunk 14: read_data
cov_j = cov %>%
group_by(province, month, year, status) %>%
summarise(n= n()) %>%
pivot_wider(names_from = status, values_from = n) %>%
mutate_if(is.integer, ~replace(., is.na(.), 0)) %>%
mutate(case_fatality = (D / (D+R)*100)) %>%
left_join(doses_dates) %>%
select(-c(R, D)) %>%
mutate(doses = if_else(is.na(doses), 0, doses)) %>%
left_join(population) %>%
select(-region_id) %>%
mutate(doses_per_capita = (doses/population)*100) %>%
select(-c(population, doses)) %>%
select(case_fatality, doses_per_capita)
cov_j %>%
group_by(province) %>%
summarise(case_fatality = mean(case_fatality),
doses_per_capita = mean(doses_per_capita)) %>%
ungroup() %>%
select(case_fatality, doses_per_capita) %>%
correlation()
doses_shots <- read_csv("C:/Users/PC/Desktop/doses_shots.csv")
updateR()
install.packages("installr")
library(installr)
updateR()
